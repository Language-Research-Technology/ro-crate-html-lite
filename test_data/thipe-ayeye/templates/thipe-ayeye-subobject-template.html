<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>

    {# Facebook sharing image (Open Graph) #}
    <meta property="og:type" content="website" />
    <meta property="og:title" content="{{ data.ids[data.entryPoint].props['http://schema.org/name'].fwd[0].value }}" />
    <meta property="og:description" content="{{ data.ids[data.entryPoint].props.sentence.fwd[0].value }}" />
    <meta name="description" content="{{ data.ids[data.entryPoint].props.sentence.fwd[0].value }}" />

    {% set domain = data.pages[data.entryPoint].domain %}
    {% set path = data.pages[data.entryPoint].path %}

    {% if domain and data.ids[data.entryPoint].props["http://schema.org/hasPart"] %}
        <meta property="og:url" content="https://{{ domain }}/{{ path }}" />
        {% for val in data.ids[data.entryPoint].props["http://schema.org/hasPart"].fwd %}
            {% if val.target_name and (val.target_name.endsWith(".jpg") or val.target_name.endsWith(".png")) %}
                <meta property="og:image" content="http://{{ domain }}/{{ val.target_name }}" />
                <meta property="og:image:secure_url" content="https://{{ domain }}/{{ val.target_name }}" />
            {% endif %}
        {% endfor %}
    {% endif %}

    <style>
        html, body {
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, 'Liberation Sans', sans-serif;
            background-color: #d3f4fe;
            background-image: url(../../../../../files/images/clouds-background.png);
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            margin: 0;
        }
        .main-container {
            display: flex;
            flex-direction: column;
            width: 100vw;
            min-height: 100vh;
        }
        .middle-column {
            width: 60vw;
            max-width: 900px;
            margin: 0 auto;
        }
        @media (max-width: 700px) {
            .middle-column {
                width: 90vw;
                max-width: 90vw;
                border-radius: 0;
                padding-left: 0.5em;
                padding-right: 0.5em;
            }
        }
        .page-header-row {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            background-color: black;
            padding: 0.5em 1em;
        }
        .home-link {
            flex: 0 0 auto;
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }
        .page-title {
            flex: 1 1 0;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
        }
        .page-title-audio {
            display: flex;
            justify-content: center;
            margin-bottom: 0.5em;
        }
        .page-title-text {
            text-align: center;
            color: white;
            font-weight: normal;
            padding: 1em;
            margin: 0;
        }
        .feature-image,
        .feature-audio {
            text-align: center;
        }
        .feature-image img {
            max-width: 100%;
            height: auto;
            border: 1px solid #aaa;
            border-radius: 4px;
            box-shadow: 4px 4px 6px rgba(0,0,0,0.2);
        }
        .hide {
            display: none;
        }
        .property-row {
            display: flex;
            flex-direction: row;
            border-bottom: 1px solid #ddd;
            padding: 0.5em 0;
        }
        .property-name {
            flex: 0 0 200px;
            padding-right: 1em;
            box-sizing: border-box;
        }
        .linnaean-name, 
        .translation {
            font-style: italic;
            color: #555;
        }
        /* AUDIO PLAYER */
        .audio-play-btn {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            outline: none;
            transition: transform 0.1s;
        }
        .audio-play-btn:active {
            transform: scale(0.95);
        }
        .audio-play-btn.playing svg circle {
            fill: #1976d2;
        }
        /* GRID */
        .grid {
            display: grid;
            grid-template-columns: max(100px) 1fr;
        }
        .left {
            min-width: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        .right {
            min-width: 0;
            margin: 1em 0;
        }
        .v-space-1em {
            margin: 1em 0;
        }
    </style>
    <script>
        // Pause all other audio when one is played
        document.addEventListener('play', function(e){
            var audios = document.querySelectorAll('audio');
            audios.forEach(function(audio){
                if(audio !== e.target){
                    audio.pause();
                    if(audio.previousElementSibling && audio.previousElementSibling.classList)
                        audio.previousElementSibling.classList.remove('playing');
                }
            });
        }, true);
        // Remove playing class when audio ends
        document.addEventListener('ended', function(e){
            if(e.target.previousElementSibling && e.target.previousElementSibling.classList)
                e.target.previousElementSibling.classList.remove('playing');
        }, true);
    </script>

</head>
<body>

{% macro infoLink(url) %}
    {% if url %}
        {% if data.ids[url] %}
                <a href="#{{ url }}" title="See definiton for {{url}} in this RO-Crate">ⓘ</a>
        {% else %}
                <a href="{{ url }}" title="Look up definiton for {{url}}" target="_blank">ⓘ</a>
        {% endif %}
    {% endif %}
{% endmacro %}


{% macro diplayLabel(propData) %}
    {{ propData.label | replace(r/.*:/, "")  }}
{% endmacro %}


{% macro infoLink(url) %}
    {% if url %}
        {% if data.ids[url] %}
            <span class="info"><a href="#{{ url }}">ⓘ</a></span>
        {% else %}
            <span class="info"> <a href="{{ url }}" target="_blank">ⓘ</a></span>
        {% endif %}
    {% endif %}
{% endmacro %}


{% macro displayProp(prop, propData) %}
    <div class="property-row">

        <div class="property-name">
            {{ diplayLabel(propData) }}
        </div>

        <div class="property-value">
            {% if propData.fwd.length + propData.rev.length > 9 %}
                <input class="border" onkeyup="res = search(this)">
                <span class="count"> ({{ propData.fwd.length + propData.rev.length }} / {{ propData.fwd.length + propData.rev.length }})</span>
                <div class="long">
            {% else %}
                <div class="short">
            {% endif %}

            {% for val in propData.fwd %}
                <div>   
                    {% if val is string %}
                        {{ val }}
                    {% elif val["url"] %}
                        <a href="{{ val["url"] }}"> {{ val["url"]  }}</a>
                    {% elif val["target_id"] and data.pages[val["target_id"]] %}
                        <span class="button-right"><a href="../../../../../{{ data.pages[val["target_id"]]["path"] }}">  {{ val["target_name"] }} </a></span>
                    {% elif val.value %}
                        {{ val.value }}
                    {% elif val.target_name %}
                        {{ val.target_name }}
                    {% else %}
                        WARNING SOMETHING WENT WRONG {{ val | dump }}
                    {% endif %}
                <br>
                </div>
            {% endfor %}

            {% for val in propData.rev %}
                <div>
                    {% if val["target_id"] and data.pages[val["target_id"]] %}
                        <span class="button-left"><a href="../../../../../{{ data.pages[val["target_id"]]["path"] }}">  {{ val["target_name"] }} </a></span>
                    {% elif val.target_name %}
                        {{ val.target_name }}
                    {% else %}
                        WARNING SOMETHING WENT WRONG {{ val | dump }} ⬅
                    {% endif %}
                </div>
            {% endfor %}
            
            </div> <!-- Close the long/short div -->
        </div> <!-- Close property-value div -->
    </div> <!-- Close property-row div -->
{% endmacro %}


{% macro root() %}  
    <div class="home-link">
        <a href="../../../../../ro-crate-preview.html" class="root">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 48 48" id="Arrow-Back-Circle--Streamline-Ionic-Filled" height="48" width="48">
            <desc>
                Back
            </desc>
            <path fill="#fff" d="M0.48 24.0001C0.48 36.9892 11.0108 47.52 23.9999 47.52c12.9893 0 23.5201 -10.5308 23.5201 -23.5199C47.52 11.0108 36.9892 0.48 23.9999 0.48 11.0108 0.48 0.48 11.0108 0.48 24.0001Zm24.0458 -10.3308c0.1686 0.1673 0.3028 0.3662 0.3947 0.5854 0.0918 0.2193 0.1394 0.4543 0.1405 0.692 0.0008 0.2376 -0.045 0.473 -0.1351 0.6929 -0.0901 0.22 -0.2225 0.4199 -0.3899 0.5886l-5.9162 5.9626h15.1048c0.4798 0 0.9401 0.1906 1.2793 0.5299s0.5299 0.7995 0.5299 1.2793c0 0.4797 -0.1906 0.94 -0.5299 1.2793s-0.7995 0.5299 -1.2793 0.5299H18.6198l5.9162 5.9626c0.1674 0.1688 0.2997 0.3689 0.3898 0.5889 0.09 0.2202 0.1358 0.4557 0.1347 0.6935 -0.0009 0.2377 -0.049 0.4729 -0.1409 0.6921 -0.0919 0.2191 -0.2261 0.4181 -0.395 0.5856 -0.1687 0.1673 -0.369 0.2997 -0.589 0.3897 -0.22 0.0901 -0.4555 0.1358 -0.6934 0.1348 -0.2376 -0.0011 -0.4728 -0.049 -0.6921 -0.1409 -0.2191 -0.092 -0.4182 -0.2261 -0.5855 -0.395l-8.9772 -9.0461c-0.3363 -0.339 -0.525 -0.797 -0.525 -1.2744 0 -0.4775 0.1887 -0.9355 0.525 -1.2744l8.9772 -9.0461c0.1673 -0.1691 0.3665 -0.3034 0.5859 -0.3954 0.2193 -0.0921 0.4546 -0.1399 0.6926 -0.1409 0.2378 -0.001 0.4736 0.0451 0.6938 0.1353 0.2201 0.0902 0.4202 0.223 0.5889 0.3908Z" stroke-width="1"></path>
            </svg>
        </a>
    </div>
{% endmacro %}


{% macro showHasPart(item) %}
    {% if item.props["http://schema.org/hasPart"] %}
        <div class="has-part-list"> showHasPart:
            {% for val in item.props["http://schema.org/hasPart"].fwd %}
                <div class="has-part-item">
                    {% if val.target_id and data.pages[val.target_id] %}
                        <a href="{{ data.pages[val.target_id].path }}">{{ val.target_name }}</a>
                    {% elif val.target_name %}
                        {{ val.target_name }}
                    {% elif val.value %}
                        {{ val.value }}
                    {% else %}
                        {{ val | dump }}
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endmacro %}


{% macro showHasPartImage(item) %}
    {% if item.props["arcp://name,custom/terms#image"] %}
        {% set img = item.props["arcp://name,custom/terms#image"].fwd[0].target_id %}
        <script>
            console.log("img:", {{ img | dump | safe }});
        </script>   
        <div class="has-part-list">
            <div class="has-part-item">
                <img src="../../../../../{{ img }}" />
            </div>
        </div>
    {% endif %}
{% endmacro %}


{% macro showHasPartAudio(item) %}
    {% if item.props["http://schema.org/hasPart"] %}
        <div class="has-part-list">
            {% for val in item.props["http://schema.org/hasPart"].fwd %}
                {% if val.target_name.endsWith(".mp3") %}    
                    <div class="has-part-item">
                        <audio controls>
                            <source src="../../../../../{{ val.target_name }}" type="audio/mpeg">
                        </audio>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
{% endmacro %}


{% macro showHasPartCallAudio(item) %}
    {% if item.props["arcp://name,custom/terms#callAudio"] %}
        {% set callAudio = item.props["arcp://name,custom/terms#callAudio"].fwd[0].target_id %}
        <script>
            console.log("call audio:", {{ callAudio | dump | safe }});
        </script>   
        <button class="audio-play-btn" onclick="event.preventDefault(); var audio = this.nextElementSibling; if(audio.paused){ audio.play(); this.classList.add('playing'); } else { audio.pause(); this.classList.remove('playing'); }">
            <svg width="48" height="48" viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="22" fill="#222" />
                <polygon points="18,14 36,24 18,34" fill="#fff"/>
            </svg>
        </button>
        <audio style="display:none;">
            <source src="../../../../../{{ callAudio }}" type="audio/mpeg">
        </audio>
    {% endif %}
{% endmacro %}


{% macro showHasPartNameAudio(item) %}
    {% if item.props["arcp://name,custom/terms#nameAudio"] %}
        {% set nameAudio = item.props["arcp://name,custom/terms#nameAudio"].fwd[0].target_id %}
        <script>
            console.log("name audio:", {{ nameAudio | dump | safe }});
        </script>   
        <button class="audio-play-btn" onclick="event.preventDefault(); var audio = this.nextElementSibling; if(audio.paused){ audio.play(); this.classList.add('playing'); } else { audio.pause(); this.classList.remove('playing'); }">
            <svg width="48" height="48" viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="22" fill="#222" />
                <polygon points="18,14 36,24 18,34" fill="#fff"/>
            </svg>
        </button>
        <audio style="display:none;">
            <source src="../../../../../{{ nameAudio }}" type="audio/mpeg">
        </audio>
    {% endif %}
{% endmacro %}


{% macro showHasPartSentenceAudio(item) %}
    {% if item.props["arcp://name,custom/terms#sentenceAudio"] %}
        {% set sentenceAudio = item.props["arcp://name,custom/terms#sentenceAudio"].fwd[0].target_id %}
        <script>
            console.log("sentence audio:", {{ sentenceAudio | dump | safe }});
        </script>   
        <button class="audio-play-btn" onclick="event.preventDefault(); var audio = this.nextElementSibling; if(audio.paused){ audio.play(); this.classList.add('playing'); } else { audio.pause(); this.classList.remove('playing'); }">
            <svg width="48" height="48" viewBox="0 0 48 48">
                <circle cx="24" cy="24" r="22" fill="#222" />
                <polygon points="18,14 36,24 18,34" fill="#fff"/>
            </svg>
        </button>
        <audio style="display:none;">
            <source src="../../../../../{{ sentenceAudio }}" type="audio/mpeg">
        </audio>
    {% endif %}
{% endmacro %}


{% macro display(item, class) %}
    <!-- Heading Section -->
    <div id="{{item.id}}" class="main-container {{class}}">
        <div class="page-header-row">
            <!-- Navigation -->
            <div class="home-link">
                {{ root() }}
            </div>
            <!-- Title -->
            <div class="page-title">
                {% if item.props and "http://schema.org/name" in item.props and item.props["http://schema.org/name"].fwd %}
                    <div class="page-title-audio">{{ showHasPartNameAudio(item) }}</div>
                    <h2 class="page-title-text">{{ item.props["http://schema.org/name"].fwd[0].value }}</h2>
                {% else %} <!-- Use ID if name isn't available, e.g. files -->
                    <h2 class="page-title-text">{{ item.id }}</h2>
                {% endif %}
            </div>
        </div>

        <!-- Properties section -->
        <div class="middle-column property-grid">
            {% set seenProps = {"@id": true, "@type": true} %}
            
            <script>
                console.log('item.props:', {{ item.props | dump | safe }});
            </script>

            <div class="grid feature-image v-space-1em">
                <div class="left">
                    {{ showHasPartCallAudio(item) }}
                </div>
                <div class="right">
                    {{ showHasPartImage(item) }}
                </div>
            </div>

            <div class="grid">
                <div class="left"></div>
                <div class="right">
                    <p>
                        {{ item.props["arcp://name,custom/terms#translation"].fwd[0].value }}
                    </p>
                    <p class="linnaean-name">
                        {{ item.props["arcp://name,custom/terms#scientificName"].fwd[0].value }}
                    </p>
                </div>
            </div>

            <div class="grid">
                <div class="left">{{ showHasPartSentenceAudio(item) }}</div>
                <div class="right">
                    {{ item.props["arcp://name,custom/terms#sentence"].fwd[0].value }}
                </div>
            </div>

            <div class="grid">
                <div class="left"></div>
                <div class="right">
                    <span class="translation">
                        {{ item.props["arcp://name,custom/terms#sentenceTranslation"].fwd[0].value }}
                    </span>
                </div>
            </div>
        </div>
    </div>
{% endmacro %}


{{ display(data.ids[data.entryPoint], "root") }}

</body>
</html>